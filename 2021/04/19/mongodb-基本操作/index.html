<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="小林"><meta name="copyright" content="小林"><meta name="generator" content="Hexo 5.4.1"><meta name="theme" content="hexo-theme-yun"><title>mongodb-基本操作 | 小林の空中基地</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"小林の空中基地","version":"1.9.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-1LL0D86CY9"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1LL0D86CY9');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="MongoDBMongoDB介绍12345678非关系型数据库（存储数据，json格式存储）跟非关系数据库的对应关系mysql					mongodb	 库						  库 表						表&#x2F;集合行数据					 文档（json）不支持连表操作，有索引，默认_id字段为索引字段，自动将其升为主键  安装&amp;配置1234567891011121314151617181920212223242">
<meta property="og:type" content="article">
<meta property="og:title" content="mongodb-基本操作">
<meta property="og:url" content="http://example.com/2021/04/19/mongodb-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="小林の空中基地">
<meta property="og:description" content="MongoDBMongoDB介绍12345678非关系型数据库（存储数据，json格式存储）跟非关系数据库的对应关系mysql					mongodb	 库						  库 表						表&#x2F;集合行数据					 文档（json）不支持连表操作，有索引，默认_id字段为索引字段，自动将其升为主键  安装&amp;配置1234567891011121314151617181920212223242">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-04-19T08:28:50.000Z">
<meta property="article:modified_time" content="2022-03-21T07:12:36.875Z">
<meta property="article:author" content="小林">
<meta property="article:tag" content="mongodb">
<meta name="twitter:card" content="summary"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="小林"><img width="96" loading="lazy" src="/images/avatar1.jpg" alt="小林"><span class="site-author-status" title="Looking for dawn.">🌑</span></a><div class="site-author-name"><a href="/about/">小林</a></div><span class="site-name">小林の空中基地</span><sub class="site-subtitle">You're always there for me.</sub><div class="site-description">经历风雨未必现彩虹，但彩虹总在风雨后</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">45</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">13</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/xiaolin-666" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=1293010382" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/21350202" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@xiaolin.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB"><span class="toc-number">1.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">MongoDB介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-amp-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">安装&amp;配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">账号管理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">基本数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CURD%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">CURD操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.1.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C%EF%BC%88%E8%A1%A8%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">集合操作（表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%96%87%E6%A1%A3"><span class="toc-number">3.3.1.</span> <span class="toc-text">新增文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">3.3.2.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">3.3.3.</span> <span class="toc-text">修改文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">3.3.4.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">3.3.5.</span> <span class="toc-text">聚合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pymongo"><span class="toc-number">4.</span> <span class="toc-text">Pymongo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">练习题</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2021/04/19/mongodb-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="小林"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="小林の空中基地"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">mongodb-基本操作<a class="post-edit-link" href="https://github.com/xiaolin-666/xiaolin-666.github.io/tree/hexo/source/_posts/mongodb-基本操作.md" target="_blank" title="Edit this post" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2021-04-19 16:28:50" itemprop="dateCreated datePublished" datetime="2021-04-19T16:28:50+08:00">2021-04-19</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2022-03-21 15:12:36" itemprop="dateModified" datetime="2022-03-21T15:12:36+08:00">2022-03-21</time></div><div class="post-classify"><span class="post-tag"><a class="tag-item" href="/tags/mongodb/" style="--text-color:#ccb44b"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">mongodb</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h3 id="MongoDB介绍"><a href="#MongoDB介绍" class="headerlink" title="MongoDB介绍"></a>MongoDB介绍</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">非关系型数据库（存储数据，json格式存储）</span><br><span class="line">跟非关系数据库的对应关系</span><br><span class="line">mysql					mongodb	</span><br><span class="line"> 库						  库</span><br><span class="line"> 表						表/集合</span><br><span class="line">行数据					 文档（json）</span><br><span class="line"></span><br><span class="line">不支持连表操作，有索引，默认_id字段为索引字段，自动将其升为主键</span><br></pre></td></tr></table></figure>

<h3 id="安装-amp-配置"><a href="#安装-amp-配置" class="headerlink" title="安装&amp;配置"></a>安装&amp;配置</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">下载地址 https:<span class="comment">//www.mongodb.com/download-center/community，选择平台下载</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>安装，一路下一步</span><br><span class="line"><span class="number">2.</span>会自动创建文件db和mongod.log文件,自动创建服务</span><br><span class="line"><span class="number">3.</span>注意bin路径下的配置文件mongod.cfg</span><br><span class="line">    storage:</span><br><span class="line">      dbPath: C:\Program Files\MongoDB\Server\<span class="number">4.2</span>\data</span><br><span class="line">      journal:</span><br><span class="line">        enabled: <span class="literal">true</span></span><br><span class="line">    # where to write logging data.</span><br><span class="line">    systemLog:</span><br><span class="line">      destination: file</span><br><span class="line">      logAppend: <span class="literal">true</span></span><br><span class="line">      path:  C:\Program Files\MongoDB\Server\<span class="number">4.2</span>\log\mongod.log</span><br><span class="line">    # network interfaces</span><br><span class="line">    net:</span><br><span class="line">      port: <span class="number">27017</span></span><br><span class="line">      bindIp: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="number">4.</span>启动\关闭</span><br><span class="line">net start MongoDB</span><br><span class="line">net stop MongoDB</span><br><span class="line">mongod --config <span class="string">&quot;mongod.cfg&quot;</span> --service</span><br><span class="line"><span class="number">5.</span>登录</span><br><span class="line">mongo</span><br><span class="line">远程连接：mongo --host <span class="number">10.0</span><span class="number">.0</span><span class="number">.5</span> --port <span class="number">27017</span></span><br><span class="line"><span class="number">6.</span>安装robo3t（客户端，等同于Navicat）</span><br></pre></td></tr></table></figure>

<h4 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Read：允许用户读取指定数据库</span><br><span class="line">readWrite：允许用户读写指定数据库</span><br><span class="line">dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</span><br><span class="line">userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</span><br><span class="line">clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</span><br><span class="line">readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限</span><br><span class="line">readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限</span><br><span class="line">userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</span><br><span class="line">dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</span><br><span class="line">root：只在admin数据库中可用。超级账号，超级权限(本次创建的就是超级账号)</span><br><span class="line"></span><br><span class="line">管理员账号要建在amdin库下</span><br><span class="line">要管理哪个库，就在哪个库下建账号,删除用户，用户创建的库也没了</span><br><span class="line"><span class="number">1.</span>创建账号</span><br><span class="line"># 切换到admin库下</span><br><span class="line">use admin</span><br><span class="line"># 创建用户赋予权限</span><br><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    pwd: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    roles: [ &#123; role: <span class="string">&quot;root&quot;</span>, db: <span class="string">&quot;admin&quot;</span> &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">use test # 如果数据库不存在，不会报错，也不会显示出，只有插入数据才会创建</span><br><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: <span class="string">&quot;lucky&quot;</span>,</span><br><span class="line">    pwd: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    roles: [ &#123; role: <span class="string">&quot;readWrite&quot;</span>, db: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">             &#123; role: <span class="string">&quot;read&quot;</span>, db: <span class="string">&quot;db1&quot;</span> &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"><span class="number">2.</span>重启数据库</span><br><span class="line"><span class="number">2.1</span>在重启mongod之前，修改配置文件mongo.config，在最下面加入这么一行，mongodb默认不启用授权认证，只要能连接到该服务器，就可连接到mongod。若要启用安全认证，需要更改配置文件参数security:</span><br><span class="line">  authorization: enabled</span><br><span class="line"></span><br><span class="line">net stop MongoDB</span><br><span class="line">net start MongoDB</span><br><span class="line"># 需要以开启认证的方式启动mongodb服务</span><br><span class="line">mongod --config <span class="string">&quot;mongod.cfg&quot;</span> --auth <span class="comment">// 开启认证</span></span><br><span class="line"># 以管理员登陆</span><br><span class="line">mongo -u <span class="string">&quot;root&quot;</span> -p <span class="string">&quot;123&quot;</span> --authenticationDatabase <span class="string">&quot;admin&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><p>1、在概念上，MongoDB的文档与Javascript的对象相近，因而可以认为它类似于JSON。JSON（<a href="http://www.json.org）是一种简单的数据表示方式：其规范仅用一段文字就能描述清楚（其官网证明了这点），且仅包含六种数据类型。/">http://www.json.org）是一种简单的数据表示方式：其规范仅用一段文字就能描述清楚（其官网证明了这点），且仅包含六种数据类型。</a></p>
<p>2、这样有很多好处：易于理解、易于解析、易于记忆。然而从另一方面说，因为只有null、布尔、数字、字符串、数字和对象这几种数据类型，所以JSON的表达能力有一定的局限。</p>
<p>3、虽然JSON具备的这些类型已经具有很强的表现力，但绝大数应用（尤其是在于数据库打交道时）都还需要其他一些重要的类型。例如，JSON没有日期类型，这使得原本容易日期处理变得烦人。另外，JSON只有一种数字类型，无法区分浮点数和整数，更别区分32位和64位了。再者JSON无法表示其他一些通用类型，如正则表达式或函数。</p>
<p>4、MongoDB在保留了JSON基本键/值对特性的基础上，添加了其他一些数据类型。在不同的编程语言下，这些类型的确切表示有些许差异。下面说明了MongoDB支持的其他通用类型，以及如何正在文档中使用它们</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、null：用于表示空或不存在的字段</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:null&#125;</span><br><span class="line"><span class="comment">#2、布尔型：true和false</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="literal">true</span>,<span class="string">&#x27;y&#x27;</span>:<span class="literal">false</span>&#125;</span><br><span class="line"><span class="comment">#3、数值</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:3,<span class="string">&#x27;y&#x27;</span>:3.1415926&#125;</span><br><span class="line"><span class="comment">#4、字符串</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;lucky&#x27;</span>&#125;</span><br><span class="line"><span class="comment">#5、日期</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:new Date()&#125;</span><br><span class="line">d.x.getHours()</span><br><span class="line"><span class="comment">#6、正则表达式</span></span><br><span class="line">d=&#123;<span class="string">&#x27;pattern&#x27;</span>:/^lucky.*?nb$/i&#125;</span><br><span class="line"></span><br><span class="line">正则写在／／内，后面的i代表:</span><br><span class="line">i 忽略大小写</span><br><span class="line">m 多行匹配模式</span><br><span class="line">x 忽略非转义的空白字符</span><br><span class="line">s 单行匹配模式</span><br><span class="line"></span><br><span class="line"><span class="comment">#7、数组</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:[1,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;v&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#8、内嵌文档</span></span><br><span class="line">user=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lucky&#x27;</span>,<span class="string">&#x27;addr&#x27;</span>:&#123;<span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;YT&#x27;</span>&#125;&#125;</span><br><span class="line">user.addr.country</span><br><span class="line"></span><br><span class="line"><span class="comment">#9、对象id:是一个12字节的ID,是文档的唯一标识，不可变</span></span><br><span class="line">d=&#123;<span class="string">&#x27;x&#x27;</span>:ObjectId()&#125;</span><br></pre></td></tr></table></figure>

<p>_id和Objectid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">MongoDB中存储的文档必须有一个<span class="string">&quot;_id&quot;</span>键。这个键的值可以是任意类型，默认是个ObjectId对象。</span><br><span class="line">在一个集合里，每个文档都有唯一的“_id”,确保集合里每个文档都能被唯一标识。</span><br><span class="line">不同集合<span class="string">&quot;_id&quot;</span>的值可以重复，但同一集合内<span class="string">&quot;_id&quot;</span>的值必须唯一</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、ObjectId</span></span><br><span class="line">ObjectId是<span class="string">&quot;_id&quot;</span>的默认类型。因为设计MongoDb的初衷就是用作分布式数据库，所以能够在分片环境中生成</span><br><span class="line">唯一的标识符非常重要，而常规的做法：在多个服务器上同步自动增加主键既费时又费力，这就是MongoDB采用</span><br><span class="line">ObjectId的原因。</span><br><span class="line">ObjectId采用12字节的存储空间，是一个由24个十六进制数字组成的字符串</span><br><span class="line">    0|1|2|3|   4|5|6|     7|8    9|10|11    </span><br><span class="line">    时间戳      机器      PID    计数器</span><br><span class="line">如果快速创建多个ObjectId，会发现每次只有最后几位有变化。另外，中间的几位数字也会变化（要是在创建过程中停顿几秒）。</span><br><span class="line">这是ObjectId的创建方式导致的，如上图</span><br><span class="line"></span><br><span class="line">时间戳单位为秒，与随后5个字节组合起来，提供了秒级的唯一性。这个4个字节隐藏了文档的创建时间，绝大多数驱动程序都会提供</span><br><span class="line">一个方法，用于从ObjectId中获取这些信息。</span><br><span class="line"></span><br><span class="line">因为使用的是当前时间，很多用户担心要对服务器进行时钟同步。其实没必要，因为时间戳的实际值并不重要，只要它总是不停增加就好。</span><br><span class="line">接下来3个字节是所在主机的唯一标识符。通常是机器主机名的散列值。这样就可以保证不同主机生成不同的ObjectId，不产生冲突</span><br><span class="line"></span><br><span class="line">接下来连个字节确保了在同一台机器上并发的多个进程产生的ObjectId是唯一的</span><br><span class="line"></span><br><span class="line">前9个字节确保了同一秒钟不同机器不同进程产生的ObjectId是唯一的。最后3个字节是一个自动增加的 计数器。确保相同进程的同一秒产生的</span><br><span class="line">ObjectId也是不一样的。</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、自动生成_id</span></span><br><span class="line">如果插入文档时没有<span class="string">&quot;_id&quot;</span>键，系统会自帮你创建 一个。可以由MongoDb服务器来做这件事。</span><br><span class="line">但通常会在客户端由驱动程序完成。这一做法非常好地体现了MongoDb的哲学：能交给客户端驱动程序来做的事情就不要交给服务器来做。</span><br><span class="line">这种理念背后的原因是：即便是像MongoDB这样扩展性非常好的数据库，扩展应用层也要比扩展数据库层容易的多。将工作交给客户端做就</span><br><span class="line">减轻了数据库扩展的负担。</span><br></pre></td></tr></table></figure>

<h2 id="CURD操作"><a href="#CURD操作" class="headerlink" title="CURD操作"></a>CURD操作</h2><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、增</span></span><br><span class="line">use config <span class="comment">#如果数据库不存在，则创建数据库，否则切换到指定数据库。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、查</span></span><br><span class="line">show dbs <span class="comment">#查看所有</span></span><br><span class="line">可以看到，我们刚创建的数据库config并不在数据库的列表中， 要显示它，我们需要向config数据库插入一些数据。</span><br><span class="line">db.table1.insert(&#123;<span class="string">&#x27;a&#x27;</span>:1&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、删</span></span><br><span class="line">use config <span class="comment">#先切换到要删的库下</span></span><br><span class="line">db.dropDatabase() <span class="comment">#删除当前库</span></span><br></pre></td></tr></table></figure>

<h3 id="集合操作（表）"><a href="#集合操作（表）" class="headerlink" title="集合操作（表）"></a>集合操作（表）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、增</span></span><br><span class="line">当第一个文档插入时，集合就会被创建</span><br><span class="line">&gt; use database1</span><br><span class="line">switched to db database1</span><br><span class="line">&gt; db.table1.insert(&#123;<span class="string">&#x27;a&#x27;</span>:1&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">&quot;nInserted&quot;</span> : 1 &#125;)</span><br><span class="line">&gt; db.table2.insert(&#123;<span class="string">&#x27;b&#x27;</span>:2&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">&quot;nInserted&quot;</span> : 1 &#125;)</span><br><span class="line"><span class="comment">#注意 db.user和db.user.info是两个表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、查</span></span><br><span class="line">&gt; show collections</span><br><span class="line">&gt; show tables</span><br><span class="line">table1</span><br><span class="line">table2</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、删</span></span><br><span class="line">&gt; db.table1.drop()</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; show tables</span><br><span class="line">table2</span><br></pre></td></tr></table></figure>

<h3 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h3><h4 id="新增文档"><a href="#新增文档" class="headerlink" title="新增文档"></a>新增文档</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#单条插入与多条插入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1、没有指定_id则默认ObjectId,_id不能重复，且在插入后不可变</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、插入单条</span></span><br><span class="line">user0=&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:10,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;BJ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db.test.insert(user0)</span><br><span class="line">db.test.find()</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、插入多条</span></span><br><span class="line">user1=&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>:1,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:10,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;weifang&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user2=&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>:2,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:20,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;run&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;hebei&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db.user.insertMany([user1,user2])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有则覆盖，没则新增</span></span><br><span class="line">db.user.save(&#123;<span class="string">&quot;_id&quot;</span>:1,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;)</span><br><span class="line">db.user.save(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h4><p>比较运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比较运算</span></span><br><span class="line"><span class="comment"># SQL：=,!=,&gt;,&lt;,&gt;=,&lt;=</span></span><br><span class="line"><span class="comment"># MongoDB：&#123;key:value&#125;代表什么等于什么,&quot;$ne&quot;,&quot;$gt&quot;,&quot;$lt&quot;,&quot;gte&quot;,&quot;lte&quot;,其中&quot;$ne&quot;能用于所有数据类型</span></span><br><span class="line">db.user.find().pretty()  <span class="comment"># 以json格式显示，了解</span></span><br><span class="line"><span class="comment">#1、select * from db1.user where name = &quot;lucky1&quot;;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lucky1&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、select * from db1.user where name != &quot;lucky2&quot;;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;name&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$ne</span>&quot;</span>:<span class="string">&#x27;lucky2&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、select * from db1.user where id &gt; 2;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&#x27;$gt&#x27;</span>:2&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、select * from db1.user where id &lt; 3;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&#x27;$lt&#x27;</span>:3&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、select * from db1.user where id &gt;= 2;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:2,&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#6、select * from db1.user where id &lt;= 2;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$lte</span>&quot;</span>:2&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>逻辑运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#逻辑运算</span></span><br><span class="line"><span class="comment"># SQL：and，or，not ，mod（取余数）</span></span><br><span class="line"><span class="comment"># MongoDB：字典中逗号分隔的多个条件是and关系，&quot;$or&quot;的条件放到[]内,&quot;$not&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1、select * from db1.user where id &gt;= 2 and id &lt; 4;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:2,<span class="string">&quot;<span class="variable">$lt</span>&quot;</span>:4&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、select * from db1.user where id &gt;= 2 and age &lt; 40;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:2&#125;,<span class="string">&quot;age&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$lt</span>&quot;</span>:40&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、select * from db1.user where id &gt;= 5 or name = &quot;lucky&quot;;</span></span><br><span class="line">db.user.find(&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$or</span>&quot;</span>:[</span><br><span class="line">        &#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:5&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4、select * from db1.user where id % 2=1;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$mod</span>&quot;</span>:[2,1]&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、上题，取反</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$not</span>&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$mod</span>&quot;</span>:[2,1]&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>成员运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 成员运算</span></span><br><span class="line"><span class="comment"># SQL：in，not in</span></span><br><span class="line"><span class="comment"># MongoDB：&quot;$in&quot;,&quot;$nin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1、select * from db1.user where age in (20,30,31);</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;age&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$in</span>&quot;</span>:[20,30,31]&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、select * from db1.user where name not in (&#x27;lucky1&#x27;,&#x27;lucky2&#x27;);</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$nin</span>&quot;</span>:[<span class="string">&#x27;lucky1&#x27;</span>,<span class="string">&#x27;lucky2&#x27;</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>正则匹配</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL: regexp 正则</span></span><br><span class="line"><span class="comment"># MongoDB: /正则表达/i</span></span><br><span class="line"><span class="comment">#1、select * from db1.user where name regexp &#x27;^l&#x27;;</span></span><br><span class="line"><span class="comment"># 查询名字以l开头的人</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;name&quot;</span>:/.*?/&#125;)</span><br><span class="line">db.user.find(&#123;<span class="string">&quot;name&quot;</span>:/^l/&#125;)</span><br><span class="line"><span class="comment"># 查询名字以l开头，以1结尾的所有数据</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;name&quot;</span>:/^l.*?1$/&#125;)</span><br></pre></td></tr></table></figure>

<p>取指定字段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、select name,age from db1.user where id=3;</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;_id&#x27;</span>:3&#125;,&#123;<span class="string">&#x27;_id&#x27;</span>:0,<span class="string">&#x27;name&#x27;</span>:1,<span class="string">&#x27;age&#x27;</span>:1&#125;)</span><br><span class="line"><span class="comment"># 0表示不显示，1表示显示</span></span><br></pre></td></tr></table></figure>

<p>查询数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、查看有dancing爱好的人</span></span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;hobbies&#x27;</span>:<span class="string">&#x27;dancing&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、查看既有dancing爱好又有tea爱好的人</span></span><br><span class="line">db.user.find(&#123;</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$all</span>&quot;</span>:[<span class="string">&#x27;dancing&#x27;</span>,<span class="string">&#x27;tea&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、查看第4个爱好为tea的人</span></span><br><span class="line">db.user.find(&#123;<span class="string">&quot;hobbies.3&quot;</span>:<span class="string">&#x27;tea&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、查看所有人最后两个爱好(注意没有hobbies字段的也会被查出)（本质用的是取指定字段，所以要放在后面的字典中）</span></span><br><span class="line">db.user.find(&#123;&#125;,&#123;<span class="string">&#x27;hobbies&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:-2&#125;,<span class="string">&quot;age&quot;</span>:0,<span class="string">&quot;_id&quot;</span>:0,<span class="string">&quot;name&quot;</span>:0,<span class="string">&quot;addr&quot;</span>:0&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、查看所有人的第2个到第3个爱好</span></span><br><span class="line">db.user.find(&#123;&#125;,&#123;<span class="string">&#x27;hobbies&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:[1,2]&#125;,<span class="string">&quot;age&quot;</span>:0,<span class="string">&quot;_id&quot;</span>:0,<span class="string">&quot;name&quot;</span>:0,<span class="string">&quot;addr&quot;</span>:0&#125;)</span><br><span class="line"></span><br><span class="line">db.blog.find().pretty() <span class="comment">#美化</span></span><br><span class="line"></span><br><span class="line">db.blog.find(&#123;&#125;,&#123;<span class="string">&#x27;comments&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:-2&#125;&#125;).pretty() <span class="comment">#查询最后两个</span></span><br><span class="line">db.blog.find(&#123;&#125;,&#123;<span class="string">&#x27;comments&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:[1,2]&#125;&#125;).pretty() <span class="comment">#查询1到2</span></span><br></pre></td></tr></table></figure>

<p>排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 排序:--1代表升序，-1代表降序</span></span><br><span class="line">db.user.find().<span class="built_in">sort</span>(&#123;<span class="string">&quot;name&quot;</span>:1,&#125;)</span><br><span class="line">db.user.find().<span class="built_in">sort</span>(&#123;<span class="string">&quot;age&quot;</span>:-1,<span class="string">&#x27;_id&#x27;</span>:1&#125;)</span><br></pre></td></tr></table></figure>

<p>分页</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分页:--limit代表取多少个document，skip代表跳过前多少个document。 </span></span><br><span class="line"><span class="comment"># limit中表示一页显示的条数，skip(页码数*一页显示的条数)</span></span><br><span class="line">db.user.find().<span class="built_in">sort</span>(&#123;<span class="string">&#x27;age&#x27;</span>:1&#125;).<span class="built_in">limit</span>(1).skip(2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表关联</span></span><br><span class="line">user &#123;_id:1,name:lucky,age:18&#125;   一个人写多篇文章</span><br><span class="line">article ----》子查询</span><br><span class="line">	&#123;<span class="string">&#x27;userid&#x27;</span>:1,article:红楼梦&#125;</span><br><span class="line">  &#123;<span class="string">&#x27;userid&#x27;</span>:1,article:西游记&#125;</span><br></pre></td></tr></table></figure>

<p>获取数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取数量</span></span><br><span class="line">db.user.count(&#123;<span class="string">&#x27;age&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:30&#125;&#125;) </span><br><span class="line">--或者</span><br><span class="line">db.user.find(&#123;<span class="string">&#x27;age&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:30&#125;&#125;).count()</span><br></pre></td></tr></table></figure>

<p>其他</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、&#123;&#x27;key&#x27;:null&#125; 匹配key的值为null或者没有这个key</span></span><br><span class="line">db.t2.insert(&#123;<span class="string">&#x27;a&#x27;</span>:10,<span class="string">&#x27;b&#x27;</span>:111&#125;)</span><br><span class="line">db.t2.insert(&#123;<span class="string">&#x27;a&#x27;</span>:20&#125;)</span><br><span class="line">db.t2.insert(&#123;<span class="string">&#x27;b&#x27;</span>:null&#125;)</span><br><span class="line"></span><br><span class="line">&gt; db.t2.find(&#123;<span class="string">&quot;b&quot;</span>:null&#125;)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5a5cc2a7c1b4645aad959e5a&quot;</span>), <span class="string">&quot;a&quot;</span> : 20 &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5a5cc2a8c1b4645aad959e5b&quot;</span>), <span class="string">&quot;b&quot;</span> : null &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、查找所有</span></span><br><span class="line">db.user.find() <span class="comment">#等同于db.user.find(&#123;&#125;)</span></span><br><span class="line">db.user.find().pretty()</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、查找一个，与find用法一致，只是只取匹配成功的第一个</span></span><br><span class="line">db.user.findOne(&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:3&#125;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h4><p>语法介绍</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">update() 方法用于更新已存在的文档。语法格式如下：</span><br><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line">参数说明：对比update db1.t1 <span class="built_in">set</span> name=<span class="string">&#x27;lucky&#x27;</span>,sex=<span class="string">&#x27;Male&#x27;</span> <span class="built_in">where</span> name=<span class="string">&#x27;lucky1&#x27;</span> and age=18;</span><br><span class="line"></span><br><span class="line">db.collection.update(</span><br><span class="line">   &#123;name:&#123;<span class="variable">$ne</span>:lucky&#125;&#125;,</span><br><span class="line">   &#123;字典&#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line">query : 相当于<span class="built_in">where</span>条件。</span><br><span class="line">update : update的对象和一些更新的操作符（如$,<span class="variable">$inc</span>...等，相当于<span class="built_in">set</span>后面的</span><br><span class="line">upsert : 可选，默认为<span class="literal">false</span>，代表如果不存在update的记录不更新也不插入，设置为<span class="literal">true</span>代表插入。</span><br><span class="line">multi : 可选，默认为<span class="literal">false</span>，代表只更新找到的第一条记录，设为<span class="literal">true</span>,代表更新找到的全部记录。</span><br><span class="line">writeConcern :可选，抛出异常的级别。</span><br><span class="line"></span><br><span class="line">更新操作是不可分割的：若两个更新同时发送，先到达服务器的先执行，然后执行另外一个，不会破坏文档。</span><br></pre></td></tr></table></figure>

<p>覆盖式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意：除非是删除，否则_id是始终不会变的</span></span><br><span class="line"><span class="comment">#1、覆盖式:</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;age&#x27;</span>:30&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky9&quot;</span>,<span class="string">&quot;hobbies_count&quot;</span>:3&#125;)</span><br><span class="line">是用&#123;<span class="string">&quot;_id&quot;</span>:3,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky3&quot;</span>,<span class="string">&quot;hobbies_count&quot;</span>:3&#125;覆盖原来的记录</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、一种最简单的更新就是用一个新的文档完全替换匹配的文档。这适用于大规模式迁移的情况。例如</span></span><br><span class="line">var obj=db.user.findOne(&#123;<span class="string">&quot;_id&quot;</span>:4&#125;)</span><br><span class="line"></span><br><span class="line">obj.username=obj.name+<span class="string">&#x27;NB&#x27;</span></span><br><span class="line">obj.hobbies_count++</span><br><span class="line">delete obj.age</span><br><span class="line">delete obj._id</span><br><span class="line"></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;_id&quot;</span>:2&#125;,obj)</span><br></pre></td></tr></table></figure>

<p>设置$set</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置：$set</span></span><br><span class="line"></span><br><span class="line">通常文档只会有一部分需要更新。可以使用原子性的更新修改器，指定对文档中的某些字段进行更新。</span><br><span class="line">更新修改器是种特殊的键，用来指定复杂的更新操作，比如修改、增加后者删除</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、update db1.user set  name=&quot;张三&quot; where id = 2</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;_id&#x27;</span>:2&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、没有匹配成功则新增一条&#123;&quot;upsert&quot;:true&#125;</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;_id&#x27;</span>:6&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;李飞刀&quot;</span>,<span class="string">&quot;age&quot;</span>:18&#125;&#125;,&#123;<span class="string">&quot;upsert&quot;</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、默认只改匹配成功的第一条,&#123;&quot;multi&quot;:改多条&#125;</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:4&#125;&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:28&#125;&#125;)</span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;_id&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$gte</span>&quot;</span>:4&#125;&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:38&#125;&#125;,&#123;<span class="string">&quot;multi&quot;</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、修改内嵌文档，把名字为lucky4的人所在的地址国家改成Japan</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;lucky4&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;addr.country&quot;</span>:<span class="string">&quot;Japan&quot;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、把名字为lucky4的人的第2个爱好改成sleep</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;lucky4&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$set</span>&quot;</span>:&#123;<span class="string">&quot;hobbies.1&quot;</span>:<span class="string">&quot;sleep&quot;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#6、删除lucky4的爱好,$unset</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;lucky4&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$unset</span>&quot;</span>:&#123;<span class="string">&quot;hobbies&quot;</span>:<span class="string">&quot;&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>增加和减少</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#增加和减少：$inc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1、所有人年龄增加一岁</span></span><br><span class="line">db.user.update(&#123;&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$inc</span>&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:1&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;multi&quot;</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br><span class="line"><span class="comment">#2、所有人年龄减少5岁</span></span><br><span class="line">db.user.update(&#123;&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$inc</span>&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:-5&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;multi&quot;</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>添加删除组内元素<code> $push $pop $pull</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加删除数组内元素</span></span><br><span class="line">    </span><br><span class="line">往数组内添加元素:<span class="variable">$push</span></span><br><span class="line"><span class="comment">#1、为名字为lucky的人添加一个爱好read</span></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:&#123;<span class="string">&quot;hobbies&quot;</span>:<span class="string">&quot;read&quot;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、为名字为lucky的人一次添加多个爱好tea，dancing</span></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;hobbies&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$each</span>&quot;</span>:[<span class="string">&quot;tea&quot;</span>,<span class="string">&quot;dancing&quot;</span>]&#125;</span><br><span class="line">&#125;&#125;)</span><br><span class="line"></span><br><span class="line">按照位置且只能从开头或结尾删除元素：<span class="variable">$pop</span></span><br><span class="line"><span class="comment">#3、&#123;&quot;$pop&quot;:&#123;&quot;key&quot;:1&#125;&#125; 从数组末尾删除一个元素</span></span><br><span class="line"></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$pop</span>&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;hobbies&quot;</span>:1&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、&#123;&quot;$pop&quot;:&#123;&quot;key&quot;:-1&#125;&#125; 从头部删除</span></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$pop</span>&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;hobbies&quot;</span>:-1&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、按照条件删除元素,：&quot;$pull&quot; 把符合条件的统统删掉，而$pop只能从两端删</span></span><br><span class="line"><span class="comment"># 删除所有国家为chine的人的read爱好</span></span><br><span class="line">db.user.update(&#123;<span class="string">&#x27;addr.country&#x27;</span>:<span class="string">&quot;China&quot;</span>&#125;,&#123;<span class="string">&quot;<span class="variable">$pull</span>&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;hobbies&quot;</span>:<span class="string">&quot;read&quot;</span>&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;multi&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>避免重复 “$addToSet”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#避免添加重复：&quot;$addToSet&quot;</span></span><br><span class="line"></span><br><span class="line">db.urls.insert(&#123;<span class="string">&quot;_id&quot;</span>:1,<span class="string">&quot;urls&quot;</span>:[]&#125;)</span><br><span class="line"></span><br><span class="line">db.urls.update(&#123;<span class="string">&quot;_id&quot;</span>:1&#125;,&#123;<span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:&#123;<span class="string">&quot;urls&quot;</span>:<span class="string">&#x27;http://www.baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line">db.urls.update(&#123;<span class="string">&quot;_id&quot;</span>:1&#125;,&#123;<span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:&#123;<span class="string">&quot;urls&quot;</span>:<span class="string">&#x27;http://www.baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line">db.urls.update(&#123;<span class="string">&quot;_id&quot;</span>:1&#125;,&#123;<span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:&#123;<span class="string">&quot;urls&quot;</span>:<span class="string">&#x27;http://www.baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line">db.urls.update(&#123;<span class="string">&quot;_id&quot;</span>:1&#125;,&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;urls&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$each</span>&quot;</span>:[</span><br><span class="line">            <span class="string">&#x27;http://www.baidu.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;http://www.baidu.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;http://www.xxxx.com&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>其他</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、了解：限制大小&quot;$slice&quot;，只留最后n个</span></span><br><span class="line"></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;_id&quot;</span>:5&#125;,&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$push</span>&quot;</span>:&#123;<span class="string">&quot;hobbies&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$each</span>&quot;</span>:[<span class="string">&quot;read&quot;</span>,<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">        <span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:-2</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、了解：排序The $sort element value must be either 1 or -1&quot;</span></span><br><span class="line">db.user.update(&#123;<span class="string">&quot;_id&quot;</span>:5&#125;,&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$push</span>&quot;</span>:&#123;<span class="string">&quot;hobbies&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$each</span>&quot;</span>:[<span class="string">&quot;read&quot;</span>,<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">        <span class="string">&quot;<span class="variable">$slice</span>&quot;</span>:-1,</span><br><span class="line">        <span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:-1</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：不能只将&quot;$slice&quot;或者&quot;$sort&quot;与&quot;$push&quot;配合使用，且必须使用&quot;$each&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、删除多个中的第一个</span></span><br><span class="line">db.user.deleteOne(&#123; <span class="string">&#x27;age&#x27;</span>: 8 &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、删除国家为China的全部</span></span><br><span class="line">db.user.deleteMany( &#123;<span class="string">&#x27;addr.country&#x27;</span>: <span class="string">&#x27;China&#x27;</span>&#125; ) </span><br><span class="line"></span><br><span class="line"><span class="comment">#3、删除全部</span></span><br><span class="line">db.user.deleteMany(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果数据存储在MongoDB中，想做的可能就不仅仅是将数据提取出来那么简单了；可能希望对数据进行分析并加以利用。MongoDB提供了以下聚合工具：</span><br><span class="line"><span class="comment">#1、聚合框架</span></span><br><span class="line"><span class="comment">#2、MapReduce(详见MongoDB权威指南)</span></span><br><span class="line"><span class="comment">#3、几个简单聚合命令：count、distinct和group。(详见MongoDB权威指南)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#聚合框架：</span></span><br><span class="line">可以使用多个构件创建一个管道，上一个构件的结果传给下一个构件。</span><br><span class="line">这些构件包括（括号内为构件对应的操作符）：筛选(<span class="variable">$match</span>)、投射(<span class="variable">$project</span>)、分组(<span class="variable">$group</span>)、排序(<span class="variable">$sort</span>)、限制(<span class="variable">$limit</span>)、跳过(<span class="variable">$skip</span>)</span><br><span class="line">不同的管道操作符可以任意组合，重复使用</span><br></pre></td></tr></table></figure>

<p>准备数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from pymongo import MongoClient</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">client=MongoClient(<span class="string">&#x27;mongodb://root:123@localhost:27017&#x27;</span>)</span><br><span class="line">table=client[<span class="string">&#x27;db1&#x27;</span>][<span class="string">&#x27;emp&#x27;</span>]</span><br><span class="line"><span class="comment"># table.drop()</span></span><br><span class="line"></span><br><span class="line">l=[</span><br><span class="line">(<span class="string">&#x27;成龙&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,48,<span class="string">&#x27;20101111&#x27;</span>,<span class="string">&#x27;teacher&#x27;</span>,10000,401,1),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;歪歪&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,48,<span class="string">&#x27;20150311&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,3000.13,402,2),<span class="comment">#以下是销售部门</span></span><br><span class="line">(<span class="string">&#x27;丫丫&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,38,<span class="string">&#x27;20101101&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,2000.35,402,2),</span><br><span class="line">(<span class="string">&#x27;丁丁&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,18,<span class="string">&#x27;20110312&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,1000.37,402,2),</span><br><span class="line">(<span class="string">&#x27;星星&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,18,<span class="string">&#x27;20160513&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,3000.29,402,2),</span><br><span class="line">(<span class="string">&#x27;格格&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,28,<span class="string">&#x27;20170127&#x27;</span>,<span class="string">&#x27;sale&#x27;</span>,4000.33,402,2),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;张野&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,28,<span class="string">&#x27;20160311&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,10000.13,403,3), <span class="comment">#以下是运营部门</span></span><br><span class="line">(<span class="string">&#x27;程咬金&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,18,<span class="string">&#x27;19970312&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,20000,403,3),</span><br><span class="line">(<span class="string">&#x27;程咬银&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,18,<span class="string">&#x27;20130311&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,19000,403,3),</span><br><span class="line">(<span class="string">&#x27;程咬铜&#x27;</span>,<span class="string">&#x27;male&#x27;</span>,18,<span class="string">&#x27;20150411&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,18000,403,3),</span><br><span class="line">(<span class="string">&#x27;程咬铁&#x27;</span>,<span class="string">&#x27;female&#x27;</span>,18,<span class="string">&#x27;20140512&#x27;</span>,<span class="string">&#x27;operation&#x27;</span>,17000,403,3)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n,item <span class="keyword">in</span> enumerate(l):</span><br><span class="line">    d=&#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>:n,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:item[0],</span><br><span class="line">        <span class="string">&#x27;sex&#x27;</span>:item[1],</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>:item[2],</span><br><span class="line">        <span class="string">&#x27;hire_date&#x27;</span>:datetime.datetime.strptime(item[3],<span class="string">&#x27;%Y%m%d&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;post&#x27;</span>:item[4],</span><br><span class="line">        <span class="string">&#x27;salary&#x27;</span>:item[5]</span><br><span class="line">    &#125;</span><br><span class="line">    table.save(d)</span><br></pre></td></tr></table></figure>

<p>筛选 “$match”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;字段&quot;</span>:<span class="string">&quot;条件&quot;</span>&#125;&#125;,可以使用任何常用查询操作符<span class="variable">$gt</span>,<span class="variable">$lt</span>,<span class="variable">$in</span>等</span><br><span class="line"></span><br><span class="line"><span class="comment">#例1、select * from db1.emp where post=&#x27;teacher&#x27;;</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;post&quot;</span>:<span class="string">&quot;teacher&quot;</span>&#125;&#125;) <span class="comment"># shell版本不匹配，会出错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例2、select * from db1.emp where id &gt; 3 group by post;  </span></span><br><span class="line"><span class="comment"># 计算每个部门的平均工资</span></span><br><span class="line">select post as _id,avg(salary) as avg_salary from db1.emp <span class="built_in">where</span> <span class="built_in">id</span> &gt; 3 group by post;  </span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:3&#125;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&#x27;avg_salary&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例3、select post as _id,avg(salary) as avg_salary from db.emp where id &gt; 3 group by post having avg(avg_salary) &gt; 10000; </span></span><br><span class="line"><span class="comment"># 查询平均工资大于10000的部门</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:3&#125;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&#x27;avg_salary&#x27;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:10000&#125;&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>投射 $project</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;要保留的字段名&quot;</span>:1,<span class="string">&quot;要去掉的字段名&quot;</span>:0,<span class="string">&quot;新增的字段名&quot;</span>:<span class="string">&quot;表达式&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、select name,post,(age+1) as new_age from db1.emp;</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:1,</span><br><span class="line">        <span class="string">&quot;post&quot;</span>:1,</span><br><span class="line">        <span class="string">&quot;new_age&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$add</span>&quot;</span>:[<span class="string">&quot;<span class="variable">$age</span>&quot;</span>,1]&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、表达式之数学表达式</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$add</span>&quot;</span>:[expr1,expr2,...,exprN]&#125; <span class="comment">#相加</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$subtract</span>&quot;</span>:[expr1,expr2]&#125; <span class="comment">#第一个减第二个</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$multiply</span>&quot;</span>:[expr1,expr2,...,exprN]&#125; <span class="comment">#相乘</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$divide</span>&quot;</span>:[expr1,expr2]&#125; <span class="comment">#第一个表达式除以第二个表达式的商作为结果</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$mod</span>&quot;</span>:[expr1,expr2]&#125; <span class="comment">#第一个表达式除以第二个表达式得到的余数作为结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、表达式之日期表达式:$year,$month,$week,$dayOfMonth,$dayOfWeek,$dayOfYear,$hour,$minute,$second</span></span><br><span class="line"><span class="comment">#例如：select name,date_format(&quot;%Y&quot;) as hire_year from db1.emp</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:1,<span class="string">&quot;hire_year&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$year</span>&quot;</span>:<span class="string">&quot;<span class="variable">$hire_date</span>&quot;</span>&#125;&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例如查看每个员工的工作多长时间</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:1,<span class="string">&quot;hire_period&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;<span class="variable">$subtract</span>&quot;</span>:[</span><br><span class="line">            &#123;<span class="string">&quot;<span class="variable">$year</span>&quot;</span>:new Date()&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;<span class="variable">$year</span>&quot;</span>:<span class="string">&quot;<span class="variable">$hire_date</span>&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4、字符串表达式</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$substr</span>&quot;</span>:[字符串/$值为字符串的字段名,起始位置,截取几个字节]&#125;</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$concat</span>&quot;</span>:[expr1,expr2,...,exprN]&#125; <span class="comment">#指定的表达式或字符串连接在一起返回,只支持字符串拼接</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$toLower</span>&quot;</span>:<span class="built_in">expr</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$toUpper</span>&quot;</span>:<span class="built_in">expr</span>&#125;</span><br><span class="line"></span><br><span class="line">db.emp.aggregate( &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;NAME&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$toUpper</span>&quot;</span>:<span class="string">&quot;<span class="variable">$name</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除丫丫外，所有人名字加SB</span></span><br><span class="line"></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$ne</span>&quot;</span>:<span class="string">&quot;丫丫&quot;</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:</span><br><span class="line">        &#123;<span class="string">&quot;_id&quot;</span>:0,<span class="string">&quot;new_name&quot;</span>:</span><br><span class="line">            &#123;<span class="string">&quot;<span class="variable">$concat</span>&quot;</span>:</span><br><span class="line">                [<span class="string">&quot;<span class="variable">$name</span>&quot;</span>,<span class="string">&quot;SB&quot;</span>]</span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;&#125;            </span><br><span class="line">)</span><br><span class="line"><span class="comment"># 取除lucky外， 所有人名字3个字节（utf8编码，3个字节一个汉字）</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$ne</span>&quot;</span>:<span class="string">&quot;lucky&quot;</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:</span><br><span class="line">        &#123;<span class="string">&quot;_id&quot;</span>:0,<span class="string">&quot;new_name&quot;</span>:</span><br><span class="line">            &#123;<span class="string">&quot;<span class="variable">$substr</span>&quot;</span>:</span><br><span class="line">                [<span class="string">&quot;<span class="variable">$name</span>&quot;</span>,0,3]</span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;&#125;            </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>分组 $group</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:分组字段,<span class="string">&quot;新的字段名&quot;</span>:聚合操作符&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、将分组字段传给$group函数的_id字段即可</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$sex</span>&quot;</span>&#125;&#125; <span class="comment">#按照性别分组</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>&#125;&#125; <span class="comment">#按照职位分组</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:&#123;<span class="string">&quot;state&quot;</span>:<span class="string">&quot;<span class="variable">$state</span>&quot;</span>,<span class="string">&quot;city&quot;</span>:<span class="string">&quot;<span class="variable">$city</span>&quot;</span>&#125;&#125;&#125; <span class="comment">#按照多个字段分组，比如按照州市分组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、分组后聚合得结果,类似于sql中聚合函数的聚合操作符：$sum、$avg、$max、$min、$first、$last</span></span><br><span class="line"><span class="comment">#例1：select post,max(salary) as max_salary from db1.emp group by post; </span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;max_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$max</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例2：去每个部门最大薪资与最低薪资</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;max_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$max</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;,<span class="string">&quot;min_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$min</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例3：如果字段是排序后的，那么$first,$last会很有用,比用$max和$min效率高</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;first_id&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$first</span>&quot;</span>:<span class="string">&quot;<span class="variable">$_id</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例4：求每个部门的总工资</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$sum</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#例5：求每个部门的人数</span></span><br><span class="line">seledt count(1) as count from emp;</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$sum</span>&quot;</span>:1&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#3、数组操作符</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:<span class="built_in">expr</span>&#125;：不重复</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:<span class="built_in">expr</span>&#125;：重复</span><br><span class="line"></span><br><span class="line"><span class="comment">#例：查询岗位名以及各岗位内的员工姓名:select post,group_concat(name) from db1.emp group by post;</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;names&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:<span class="string">&quot;<span class="variable">$name</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"><span class="comment"># 跟上面一样</span></span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;names&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$addToSet</span>&quot;</span>:<span class="string">&quot;<span class="variable">$name</span>&quot;</span>&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>排序$sort 限制 $limit 跳过 $skip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;字段名&quot;</span>:1,<span class="string">&quot;字段名&quot;</span>:-1&#125;&#125; <span class="comment">#1升序，-1降序</span></span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$limit</span>&quot;</span>:n&#125; </span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$skip</span>&quot;</span>:n&#125; <span class="comment">#跳过多少个文档</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例1、取平均工资最高的前两个部门</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;平均工资&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;平均工资&quot;</span>:-1&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$limit</span>&quot;</span>:2</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">#例2、</span></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;平均工资&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;平均工资&quot;</span>:-1&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$limit</span>&quot;</span>:3</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$skip</span>&quot;</span>:1</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;平均工资&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;平均工资&quot;</span>:-1&#125;</span><br><span class="line">&#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$skip</span>&quot;</span>:2</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$limit</span>&quot;</span>:2</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>随机选取 $sample</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#集合users包含的文档如下</span></span><br><span class="line">db.users.insertMany([</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 1, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;dave123&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">true</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">true</span> &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 2, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;dave2&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">false</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">false</span>  &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 3, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;ahn&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">true</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">true</span>  &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 4, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;li&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">true</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">false</span>  &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 5, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;annT&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">false</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">true</span>  &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 6, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;li&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">true</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">true</span>  &#125;,</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : 7, <span class="string">&quot;name&quot;</span> : <span class="string">&quot;ty&quot;</span>, <span class="string">&quot;q1&quot;</span> : <span class="literal">false</span>, <span class="string">&quot;q2&quot;</span> : <span class="literal">true</span>  &#125;</span><br><span class="line"></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">#下述操作时从users集合中随机选取3个文档</span></span><br><span class="line"><span class="comment"># 抽奖</span></span><br><span class="line">db.users.aggregate(</span><br><span class="line">   [ &#123; <span class="variable">$sample</span>: &#123; size: 1 &#125; &#125; ]</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Pymongo"><a href="#Pymongo" class="headerlink" title="Pymongo"></a>Pymongo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://api.mongodb.com/python/current/tutorial.html</span></span><br><span class="line"></span><br><span class="line">from pymongo import MongoClient</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、链接</span></span><br><span class="line">client=MongoClient(<span class="string">&#x27;mongodb://root:123@localhost:27017/&#x27;</span>)</span><br><span class="line"><span class="comment"># client = MongoClient(&#x27;localhost&#x27;, 27017)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、use 数据库</span></span><br><span class="line">db=client[<span class="string">&#x27;db2&#x27;</span>] <span class="comment">#等同于：client.db1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、查看库下所有的集合</span></span><br><span class="line"><span class="built_in">print</span>(db.collection_names(include_system_collections=False))</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、创建集合</span></span><br><span class="line">table_user=db[<span class="string">&#x27;userinfo&#x27;</span>] <span class="comment">#等同于：db.user</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5、插入文档</span></span><br><span class="line">import datetime</span><br><span class="line">user0=&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>:1,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;丫丫&quot;</span>,</span><br><span class="line">    <span class="string">&quot;birth&quot;</span>:datetime.datetime.now(),</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:10,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;BJ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user1=&#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>:2,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;lucky&quot;</span>,</span><br><span class="line">    <span class="string">&quot;birth&quot;</span>:datetime.datetime.now(),</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:10,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>:[<span class="string">&#x27;music&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;dancing&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;addr&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>:<span class="string">&#x27;China&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;weifang&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># res=table_user.insert_many([user0,user1]).inserted_ids</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># print(table_user.count())</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6、查找</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># from pprint import pprint#格式化细</span></span><br><span class="line"><span class="comment"># pprint(table_user.find_one())</span></span><br><span class="line"><span class="comment"># for item in table_user.find():</span></span><br><span class="line"><span class="comment">#     pprint(item)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(table_user.find_one(&#123;&quot;_id&quot;:&#123;&quot;$gte&quot;:1&#125;,&quot;name&quot;:&#x27;lucky&#x27;&#125;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7、更新</span></span><br><span class="line">table_user.update(&#123;<span class="string">&#x27;_id&#x27;</span>:1&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lucky&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#8、传入新的文档替换旧的文档</span></span><br><span class="line">table_user.save(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>:2,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:<span class="string">&#x27;丫丫_xxx&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip3 install pymong</span></span><br><span class="line">from pymongo import MongoClient</span><br><span class="line">from pymongo.collection import Collection</span><br><span class="line"><span class="comment">#MongoClient(&#x27;mongodb://root:123@localhost:27017/&#x27;)</span></span><br><span class="line">conn=MongoClient(host=<span class="string">&quot;10.0.0.5&quot;</span>,port=27017)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use db</span></span><br><span class="line"><span class="comment"># python中的魔法方法(init,new,str) __add__</span></span><br><span class="line"><span class="comment"># with  __enter__  __exit__</span></span><br><span class="line"></span><br><span class="line">db=conn.db  <span class="comment"># 重写了__getattr__</span></span><br><span class="line"><span class="comment"># db=conn[&quot;db&quot;] # 重写了__getitem__</span></span><br><span class="line"><span class="comment">#db.users 获取表</span></span><br><span class="line"><span class="built_in">users</span>=db.users <span class="comment"># type:Collection</span></span><br><span class="line"><span class="comment"># users.find(&#123;&#x27;name&#x27;:&quot;li&quot;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># users.insert_many()</span></span><br><span class="line"><span class="comment"># users.insert_one()</span></span><br><span class="line"><span class="comment"># update被弃用了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># users.update()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># users.aggregate(&#123;&#125;,&#123;&#125;,&#123;&#125;)</span></span><br><span class="line"><span class="comment"># users.delete_many()</span></span><br><span class="line"><span class="comment"># users.delete_one()</span></span><br><span class="line"><span class="comment"># print(users.find())</span></span><br><span class="line"><span class="comment"># for i in users.find(&#123;&#x27;name&#x27;:&quot;li&quot;&#125;):</span></span><br><span class="line"><span class="comment">#     print(type(i))</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">1. 查询岗位名以及各岗位内的员工姓名</span><br><span class="line">2. 查询岗位名以及各岗位内包含的员工个数</span><br><span class="line">3. 查询公司内男员工和女员工的个数</span><br><span class="line">4. 查询岗位名以及各岗位的平均薪资、最高薪资、最低薪资</span><br><span class="line">5. 查询男员工与男员工的平均薪资，女员工与女员工的平均薪资</span><br><span class="line">6. 查询各岗位内包含的员工个数小于2的岗位名、岗位内包含员工名字、个数</span><br><span class="line">7. 查询各岗位平均薪资大于10000的岗位名、平均工资</span><br><span class="line">8. 查询各岗位平均薪资大于10000且小于20000的岗位名、平均工资</span><br><span class="line">9. 查询所有员工信息，先按照age升序排序，如果age相同则按照hire_date降序排序</span><br><span class="line">10. 查询各岗位平均薪资大于10000的岗位名、平均工资,结果按平均薪资升序排列</span><br><span class="line">11. 查询各岗位平均薪资大于10000的岗位名、平均工资,结果按平均薪资降序排列,取前1个</span><br><span class="line">1. 查询岗位名以及各岗位内的员工姓名</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;names&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:<span class="string">&quot;<span class="variable">$name</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">2. 查询岗位名以及各岗位内包含的员工个数</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$sum</span>&quot;</span>:1&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">3. 查询公司内男员工和女员工的个数</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$sex</span>&quot;</span>,<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$sum</span>&quot;</span>:1&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">4. 查询岗位名以及各岗位的平均薪资、最高薪资、最低薪资</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;,<span class="string">&quot;max_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$max</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;,<span class="string">&quot;min_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$min</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">5. 查询男员工与男员工的平均薪资，女员工与女员工的平均薪资</span><br><span class="line">db.emp.aggregate(&#123;<span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$sex</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">6. 查询各岗位内包含的员工个数小于2的岗位名、岗位内包含员工名字、个数</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$sum</span>&quot;</span>:1&#125;,<span class="string">&quot;names&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$push</span>&quot;</span>:<span class="string">&quot;<span class="variable">$name</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;count&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$lt</span>&quot;</span>:2&#125;&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:0,<span class="string">&quot;names&quot;</span>:1,<span class="string">&quot;count&quot;</span>:1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">7. 查询各岗位平均薪资大于10000的岗位名、平均工资</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:10000&#125;&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:1,<span class="string">&quot;avg_salary&quot;</span>:1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">8. 查询各岗位平均薪资大于10000且小于20000的岗位名、平均工资</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:10000,<span class="string">&quot;<span class="variable">$lt</span>&quot;</span>:20000&#125;&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:1,<span class="string">&quot;avg_salary&quot;</span>:1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">9. 查询所有员工信息，先按照age升序排序，如果age相同则按照hire_date降序排序</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:1,<span class="string">&quot;hire_date&quot;</span>:-1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">10. 查询各岗位平均薪资大于10000的岗位名、平均工资,结果按平均薪资升序排列</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:10000&#125;&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">11. 查询各岗位平均薪资大于10000的岗位名、平均工资,结果按平均薪资降序排列,取前1个</span><br><span class="line">db.emp.aggregate(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$group</span>&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;<span class="variable">$post</span>&quot;</span>,<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$avg</span>&quot;</span>:<span class="string">&quot;<span class="variable">$salary</span>&quot;</span>&#125;&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$match</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$gt</span>&quot;</span>:10000&#125;&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$sort</span>&quot;</span>:&#123;<span class="string">&quot;avg_salary&quot;</span>:-1&#125;&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$limit</span>&quot;</span>:1&#125;,</span><br><span class="line">&#123;<span class="string">&quot;<span class="variable">$project</span>&quot;</span>:&#123;<span class="string">&quot;date&quot;</span>:new Date,<span class="string">&quot;平均工资&quot;</span>:<span class="string">&quot;<span class="variable">$avg_salary</span>&quot;</span>,<span class="string">&quot;_id&quot;</span>:0&#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">我很可爱，请给我钱</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>小林</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2021/04/19/mongodb-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" title="mongodb-基本操作">http://example.com/2021/04/19/mongodb-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/04/19/linux-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/" rel="prev" title="linux-进程和系统服务"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">linux-进程和系统服务</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/04/19/mysql-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/" rel="next" title="mysql-主从搭建"><span class="post-nav-text">mysql-主从搭建</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果您有任何关于博客内容的相关讨论，欢迎前往 <a href="https://github.com/xiaolin-666/xiaolin-666.github.io/discussions" target="_blank">GitHub Discussions</a> 与我交流。</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备17038157号</a></div><div class="copyright"><span>&copy; 2016 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 小林</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.1</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.9.1</span></div><div class="footer-support"><span>本网站由</span><a class="footer-support-logo" href="https://www.upyun.com" target="blank" title="又拍云"><img height="30" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/logo/upyun-logo.png" alt="又拍云"></a><span>提供 CDN 加速</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>